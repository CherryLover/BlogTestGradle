/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
println(" I'm first line in build.gradle ")

task hello {
    group('demo-run')
    doLast {
        println(" hello world")
    }
}

task "tryRun" {
    group("demo-run")
    dependsOn("hello")
    println(" you are in configuration")

    doLast {
        println("You run me! in Last")
    }

    doFirst {
        println(" You run me in First")
    }.doFirst {
        println(" You run me in 2nd First")
    }
}

class UserInfo {
    String userName
    String avatar
    int age
    Address address = new Address()
    NamedDomainObjectContainer<Clothes> clothesNamedDomainObjectContainer

    /**
     * UserInfo 构造方法，传入 Project 对 clothesNamedDomainObjectContainer 进行初始化
     * @param project
     */
    public UserInfo(Project project) {
        NamedDomainObjectContainer<Clothes> domainObjs = project.container(Clothes)
        clothesNamedDomainObjectContainer = domainObjs
    }

    /**
     * 添加 Clothes
     * @param action
     */
    void clothes(Action<NamedDomainObjectContainer<Clothes>> action) {
        action.execute(clothesNamedDomainObjectContainer)
    }

    void address(Closure c) {
        org.gradle.util.ConfigureUtil.configure(c, address)
    }

    void address(Action<Address> action) {
        action.execute(address)
    }

    /**
     * 打印所有 Clothes
     */
    public void printAllClothes() {
        clothesNamedDomainObjectContainer.all { singleCloth ->
            println(singleCloth.toString())
        }
    }

    String toString(){
        def info = " "
        if (address !=null) {
            info = address.getInfo()
        }
        return "userName：" + getUserName() + " avatar：" + getAvatar() + " age：" + getAge() + " address: " + info
    }
}

class Clothes {
    /**
     * 必须有 name 属性
     */
    String name
    String brand
    int year

    Clothes(String name) {
        this.name = name
    }

    String toString() {
        return getName() + " " + getBrand() + " " + getYear()
    }
}

class Address {
    String country
    String province
    String city

    String getInfo() {
        return getCountry() + " " + getProvince() + " " + getCity()
    }
}

class GreetingPlugin implements Plugin<Project> {
    void apply(Project project) {
        def userInfo = project.extensions.create("userInfo", UserInfo, project)
        project.task('helloPlugin') {
            doLast {
                userInfo.printAllClothes()
                println userInfo.toString()
                println 'Hello from the GreetingPlugin'
            }
        }
    }
}


apply plugin: GreetingPlugin


userInfo {
    userName = 'little monster'
    avatar = "no avatar"
    age = 20

    address {
        country = "China"
        province = "ShangHai"
        city = "ShangHai"
    }

    clothes {
        pants {
            brand = "Nike"
            year = 1
        }

        shoes {
            brand = "Converse"
            year = 2
        }
    }

}