import org.gradle.util.ConfigureUtil

/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
println(" I'm first line in build.gradle ")

task hello {
    group('demo-run')
    doLast {
        println(" hello world")
    }
}

task "tryRun" {
    group("demo-run")
    dependsOn("hello")
    println(" you are in configuration")

    doLast {
        println("You run me! in Last")
    }

    doFirst {
        println(" You run me in First")
    }.doFirst {
        println(" You run me in 2nd First")
    }
}

class UserInfo {
    String userName
    String avatar
    int age
    Address address = new Address()

    void address(Closure c) {
        org.gradle.util.ConfigureUtil.configure(c, address)
    }

    void address(Action<Address> action) {
        action.execute(address)
    }

    String toString(){
        def info = " "
        if (address !=null) {
            info = address.getInfo()
        }
        return "userName：" + getUserName() + " avatar：" + getAvatar() + " age：" + getAge() + " address: " + info
    }
}

class Address {
    String country
    String province
    String city

    String getInfo() {
        return getCountry() + " " + getProvince() + " " + getCity()
    }
}

class GreetingPlugin implements Plugin<Project> {
    void apply(Project project) {
        def userInfo = project.extensions.create("userInfo", UserInfo)
        project.task('helloPlugin') {
            doLast {
                println userInfo.toString()
                println 'Hello from the GreetingPlugin'
            }
        }
    }
}


apply plugin: GreetingPlugin


userInfo {
    userName = 'little monster'
    avatar = "no avatar"
    age = 20

    address {
        country = "China"
        province = "ShangHai"
        city = "ShangHai"
    }
}